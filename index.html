<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>IMAGINE</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Kalam" rel="stylesheet">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <!-- THREE library and addons -->
    <script src="build/three.js"></script>

    <script src="js/controls/FlyControls.js"></script>

    <script src="js/shaders/CopyShader.js"></script>
    <script src="js/shaders/FilmShader.js"></script>

    <script src="js/postprocessing/EffectComposer.js"></script>
    <script src="js/postprocessing/ShaderPass.js"></script>
    <script src="js/postprocessing/MaskPass.js"></script>
    <script src="js/postprocessing/RenderPass.js"></script>
    <script src="js/postprocessing/FilmPass.js"></script>

    <script src="js/Detector.js"></script>
    <script src="js/libs/stats.min.js"></script>

    <!-- link p5 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.16/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.0/addons/p5.dom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.0/addons/p5.sound.min.js"></script>
   

  </head>

  <body>
    <div class="nav">
    <ul id="left">
      <li><a>IMAGINE</a></li>
    </ul>
    <ul id="right">
      <li><a id="fs">fullscreen</a></li>
      <script>
        function toggleFullscreen(elem) {
          elem = elem || document.documentElement;
          if (!document.fullscreenElement && !document.mozFullScreenElement &&
            !document.webkitFullscreenElement && !document.msFullscreenElement) {
            if (elem.requestFullscreen) {
              elem.requestFullscreen();
            } else if (elem.msRequestFullscreen) {
              elem.msRequestFullscreen();
            } else if (elem.mozRequestFullScreen) {
              elem.mozRequestFullScreen();
            } else if (elem.webkitRequestFullscreen) {
              elem.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
            }
          } else {
            if (document.exitFullscreen) {
              document.exitFullscreen();
            } else if (document.msExitFullscreen) {
              document.msExitFullscreen();
            } else if (document.mozCancelFullScreen) {
              document.mozCancelFullScreen();
            } else if (document.webkitExitFullscreen) {
              document.webkitExitFullscreen();
            }
          }
        }
        document.getElementById('fs').addEventListener('click', function() {
          toggleFullscreen();
        });
      </script>
      <li><a onClick="soundToggle();" id="soundToggle">sound on</a></li>
      <script>
        function soundToggle() {
          if (document.getElementById('soundToggle').innerText == "sound on") {
            document.getElementById('soundToggle').innerText = "sound off";
          } else document.getElementById('soundToggle').innerText = "sound on";
        }
      </script>
      <li><a href="credits.html">CREDITS</a></li>
      <li><a href="about.html">ABOUT</a></li>
      <li><a href="index.html" class="active">HOME</a></li>
    </ul>
  </div>
  <canvas id="canvas" width=2048 height=1024></canvas>
    <script>

var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");

var geoMap, polMap;

var imageURLs = [];
var imagesOK = 0;
var imgs = [];
imageURLs.push("textures/planets/earth_atmos_2048.jpg");
imageURLs.push("img/earth2.jpg");
loadAllImages();

function loadAllImages() {
    for (var i = 0; i < imageURLs.length; i++) {
        var img = new Image();
        imgs.push(img);
        img.onload = function () {
            imagesOK++;
            imagesAllLoaded();
        };
        img.src = imageURLs[i];
    }
}

var imagesAllLoaded = function () {
    if (imagesOK == imageURLs.length) {
        // all images are fully loaded an ready to use
        geoMap = imgs[0];
        polMap = imgs[1];
        start();
    }
};


function start() {

    // save the context state
    ctx.save();

    // draw the overlay, where the white will become erased
    ctx.drawImage(polMap, 0, 0);

    // set color to white, and draw all walker geometry, 
    // further "erasing" the political map
    ctx.fillStyle = 'white';
    ctx.fillRect(0, 0, canvas.width/2, canvas.height/2);

    // change composite mode to multiply
    // The pixels are of the top layer are multiplied with the 
    // corresponding pixel of the bottom layer. A darker picture is the result.
    ctx.globalCompositeOperation = "multiply";
    // you could also try 'difference' -- whatever you choose, 
    // you may need to adjust for it in photoshop

    // draw the underlying geoMap
    ctx.drawImage(geoMap, 0, 0);

    // restore the context to it's original state
    ctx.restore();

}



    </script>

  </body>
</html>